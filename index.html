<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Elektronik Paylaşım</title>

<style>
body{
  margin:0;
  font-family:Arial;
  background:#0f172a;
  color:white;
}
header{
  background:#1e293b;
  padding:15px;
  text-align:center;
}
h1{color:#38bdf8;}

.post{
  background:#1e293b;
  margin:20px;
  padding:15px;
  border-radius:10px;
}
.post img{
  max-width:100%;
  border-radius:10px;
}

.comment{
  background:#0ea5e9;
  margin-top:5px;
  padding:5px;
  border-radius:5px;
}

#uploadBtn{
  position:fixed;
  bottom:20px;
  right:20px;
  width:70px;
  height:70px;
  border-radius:50%;
  font-size:35px;
  border:none;
  background:#38bdf8;
  z-index:9999;
}
</style>
</head>

<body>

<header>
<h1>Elektronik Paylaşım</h1>
</header>

<div id="posts"></div>

<input type="file" id="imageInput" accept="image/*" style="display:none">
<button id="uploadBtn">+</button>

<script type="module">
import { createClient } from "https://esm.sh/@supabase/supabase-js@2";

const supabase = createClient(
  "https://tfniljopfegpruxqxdgg.supabase.co",
  "sb_publishable_EcpR3uHlFWUT_YkM6Pzplw_MdLCU4cB"
);

let username = localStorage.getItem("username");
if(!username){
  username = prompt("İsmini gir:");
  localStorage.setItem("username", username);
}

const uploadBtn = document.getElementById("uploadBtn");
const imageInput = document.getElementById("imageInput");
const postsDiv = document.getElementById("posts");

uploadBtn.addEventListener("click", () => {
  imageInput.click();
});

imageInput.addEventListener("change", async () => {
  const file = imageInput.files[0];
  if(!file) return;

  const fileName = Date.now() + "-" + file.name;

  const { error } = await supabase.storage
    .from("images")
    .upload(fileName, file);

  if(error){
    alert(error.message);
    return;
  }

  const { data } = supabase.storage
    .from("images")
    .getPublicUrl(fileName);

  await supabase.from("posts").insert({
    username: username,
    image_url: data.publicUrl
  });

  loadPosts();
});

async function loadPosts(){
  const { data: posts } = await supabase
    .from("posts")
    .select("*")
    .order("created_at", { ascending: false });

  postsDiv.innerHTML = "";

  for(const post of posts){
    const div = document.createElement("div");
    div.className = "post";
    div.innerHTML = `
      <h3>${post.username}</h3>
      <img src="${post.image_url}">
    `;
    postsDiv.appendChild(div);
  }
}

loadPosts();
</script>

</body>
</html>